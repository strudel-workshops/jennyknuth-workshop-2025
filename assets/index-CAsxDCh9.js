import{d as j,j as e,B as h,F as $,p as k,q as T,t as M,v as N,G as q,H as F,J as z,S as C,T as f,D as L,o as H,R as W,P as R,L as I}from"./index-CbE6hlXP.js";import{P as V}from"./PageHeader-DrvY8s7c.js";import{S as _}from"./SciDataGrid-Zq879LL6.js";import{u as E}from"./useQuery-BkyDcZuN.js";import{S as B,I as G,a as K}from"./DataGrid-DDLij_Hc.js";import{A as y,C as J}from"./Close-6ufa7t_E.js";import{M as O}from"./MenuItem-Da47I5gc.js";import{P as Q}from"./react-plotly-C3AvELkq.js";import"./Grid-DIwCdsQu.js";import"./FilterField-9FSl4_CY.js";import"./DatePicker-Dn8a0pQ5.js";import"./DateCalendar-D3yJKzcO.js";import"./colorManipulator-D17R-yEt.js";import"./useGridRootProps-Bez4Fc_a.js";import"./Divider-Bu3U_ztR.js";import"./dividerClasses-CgsaDRlw.js";const U=async(a,s)=>{try{const n=await fetch(`${a}/info?id=${encodeURIComponent(s)}`);if(!n.ok)return console.warn(`Failed to fetch info for dataset ${s}: ${n.statusText}`),{};const r=await n.json();return r.status.code!==1200?(console.warn(`HAPI error for dataset ${s}: ${r.status.message}`),{}):{startDate:r.startDate,stopDate:r.stopDate,description:r.description}}catch(n){return console.warn(`Error fetching info for dataset ${s}:`,n),{}}},Z=a=>E({queryKey:["hapi-catalog",a],queryFn:async()=>{const s=await fetch(`${a}/catalog`);if(!s.ok)throw new Error(`Failed to fetch HAPI catalog: ${s.statusText}`);const n=await s.json();if(n.status.code!==1200)throw new Error(`HAPI error: ${n.status.message}`);const i=(n.catalog||[]).map(async o=>{const d=await U(a,o.id);return{...o,...d}});return await Promise.all(i)},staleTime:5*60*1e3}),X=({serverUrl:a,searchTerm:s,setPreviewItem:n})=>{const[r,i]=j.useState(0),[t,o]=j.useState(25),{isPending:d,isFetching:c,isError:w,data:p,error:u}=Z(a),m=j.useMemo(()=>{if(!p)return[];if(!s)return p;const l=s.toLowerCase();return p.filter(g=>{var D,P;return g.id.toLowerCase().includes(l)||((D=g.title)==null?void 0:D.toLowerCase().includes(l))||((P=g.description)==null?void 0:P.toLowerCase().includes(l))})},[p,s]),x=l=>{n(l.row)},v=l=>{const g=l.pageSize!==t?0:l.page;i(g),o(l.pageSize)};if(d){const g=new Array(t).fill(null).map((D,P)=>P);return e.jsx(h,{sx:{padding:2},children:g.map(D=>e.jsx(B,{height:50},D))})}return w?e.jsx(y,{severity:"error",children:u.message}):e.jsxs(e.Fragment,{children:[c&&e.jsx($,{variant:"indeterminate"}),e.jsx(_,{rows:m,pagination:!0,paginationMode:"client",onPaginationModelChange:v,getRowId:l=>l.id,columns:[{field:"id",headerName:"Dataset ID",width:250,flex:1},{field:"title",headerName:"Title",width:300,flex:2},{field:"startDate",headerName:"Start Date",width:180},{field:"stopDate",headerName:"Stop Date",width:180},{field:"description",headerName:"Description",width:400,flex:2}],disableColumnSelector:!0,autoHeight:!0,initialState:{pagination:{paginationModel:{page:r,pageSize:t}}},onRowClick:x})]})};var S={},A;function Y(){if(A)return S;A=1;var a=k();Object.defineProperty(S,"__esModule",{value:!0}),S.default=void 0;var s=a(T()),n=M();return S.default=(0,s.default)((0,n.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),S}var ee=Y();const te=N(ee),b=[{id:"cdaweb",name:"CDAWeb",url:"https://cdaweb.gsfc.nasa.gov/hapi"},{id:"intermagnet",name:"INTERMAGNET",url:"https://imag-data.bgs.ac.uk/GIN_V1/hapi"},{id:"lasp",name:"LASP",url:"https://lasp.colorado.edu/lisird/hapi"},{id:"knmi",name:"KNMI",url:"https://hapi.spaceweather.knmi.nl/hapi"},{id:"helioviewer",name:"Helioviewer",url:"https://api.helioviewer.org/hapi/Helioviewer/hapi"}],ae=({selectedServer:a,onServerChange:s})=>{const n=r=>{const i=b.find(t=>t.id===r.target.value);i&&s(i)};return e.jsxs(q,{sx:{minWidth:200},size:"small",children:[e.jsx(F,{id:"hapi-server-select-label",children:"HAPI Server"}),e.jsx(z,{labelId:"hapi-server-select-label",id:"hapi-server-select",value:a.id,label:"HAPI Server",onChange:n,children:b.map(r=>e.jsx(O,{value:r.id,children:r.name},r.id))})]})},re=({searchTerm:a,setSearchTerm:s,selectedServer:n,onServerChange:r})=>{const i=o=>{s(o.target.value)},t=()=>{s("")};return e.jsxs(C,{direction:"row",spacing:2,alignItems:"center",sx:{overflow:"hidden",padding:2},children:[e.jsx(f,{variant:"h6",component:"h2",flex:1,children:"HAPI Datasets"}),e.jsx(ae,{selectedServer:n,onServerChange:r}),e.jsx(L,{variant:"outlined",label:"Search",size:"small",value:a,onChange:i,InputProps:{endAdornment:a&&e.jsx(G,{position:"end",children:e.jsx(H,{"aria-label":"clear search",onClick:t,edge:"end",size:"small",children:e.jsx(te,{})})})}})]})},se=(a,s)=>E({queryKey:["hapi-data-preview",a,s],queryFn:async()=>{try{const n=await fetch(`${a}/info?id=${encodeURIComponent(s)}`);if(!n.ok)throw new Error(`Failed to fetch dataset info: ${n.statusText}`);const r=await n.json();if(r.status.code!==1200)throw new Error(`HAPI error: ${r.status.message}`);const i=r.startDate;if(!i)throw new Error("Dataset does not have a start date");const t=new Date(i),o=new Date(t);o.setDate(o.getDate()+14);const d=o.toISOString().split(".")[0]+"Z",c=await fetch(`${a}/data?id=${encodeURIComponent(s)}&time.min=${i}&time.max=${d}`);if(!c.ok)throw new Error(`Failed to fetch data: ${c.statusText}`);const p=(await c.text()).trim().split(`
`),u=[];for(let m=0;m<p.length;m++){const x=p[m].trim();if(x&&!x.startsWith("#")){const v=x.split(",");u.push(v)}}return{HAPI:r.HAPI,status:r.status,startDate:r.startDate,stopDate:r.stopDate,parameters:r.parameters||[],data:u}}catch(n){throw console.error("Error fetching HAPI data preview:",n),n}},enabled:!!a&&!!s,staleTime:10*60*1e3}),ne=({previewItem:a,serverUrl:s,onClose:n})=>{var c;const{isPending:r,isError:i,data:t,error:o}=se(s,a.id),d=W.useMemo(()=>{if(!t||!t.parameters||!t.data||t.data.length===0)return[];const w=t.data.map(u=>u[0]);return t.parameters.slice(1).map((u,m)=>{const x=m+1,v=t.data.map(l=>l[x]);return{x:w,y:v,type:"scatter",mode:"lines+markers",name:u.name,marker:{size:4},line:{width:2}}})},[t]);return e.jsx(R,{elevation:0,sx:{height:"100%",padding:2},children:e.jsxs(C,{spacing:3,children:[e.jsxs(C,{spacing:1,children:[e.jsxs(C,{direction:"row",children:[e.jsx(f,{variant:"h6",component:"h3",flex:1,children:a.title||a.id}),e.jsx(H,{size:"small",onClick:n,children:e.jsx(J,{})})]}),a.description&&e.jsx(f,{variant:"body2",children:a.description})]}),e.jsxs(h,{children:[e.jsx(f,{fontWeight:"medium",mb:1,children:"Data Preview (2 weeks)"}),r&&e.jsx(h,{sx:{display:"flex",justifyContent:"center",padding:3},children:e.jsx(K,{})}),i&&e.jsxs(y,{severity:"error",children:["Error loading data: ",(o==null?void 0:o.message)||"Unknown error"]}),t&&t.data&&t.data.length>0&&e.jsxs(h,{children:[e.jsxs(f,{variant:"body2",color:"text.secondary",mb:1,children:["Showing ",t.data.length," records from ",t.startDate]}),e.jsx(Q,{data:d,layout:{autosize:!0,margin:{l:50,r:20,t:20,b:50},xaxis:{title:((c=t.parameters[0])==null?void 0:c.name)||"Time",type:"date"},yaxis:{title:"Value"},legend:{orientation:"h",yanchor:"bottom",y:1.02,xanchor:"right",x:1},hovermode:"closest"},config:{responsive:!0,displayModeBar:!0,displaylogo:!1},style:{width:"100%",height:"400px"}})]}),t&&t.data&&t.data.length===0&&e.jsx(y,{severity:"info",children:"No data available for this dataset."})]}),e.jsxs(h,{children:[e.jsx(f,{fontWeight:"medium",mb:1,children:"Dataset Information"}),e.jsx(I,{rows:[{label:"Dataset ID",value:a.id},{label:"Title",value:a.title||"N/A"},{label:"Contact",value:a.contact||"N/A"}]})]}),e.jsxs(h,{children:[e.jsx(f,{fontWeight:"medium",mb:1,children:"Time Range"}),e.jsx(I,{rows:[{label:"Start Date",value:a.startDate||"N/A"},{label:"Stop Date",value:a.stopDate||"N/A"}]})]})]})})},Se=function(){const[s,n]=j.useState(""),[r,i]=j.useState(),[t,o]=j.useState(b[0]),d=w=>{o(w),i(null)},c=()=>{i(null)};return e.jsxs(h,{children:[e.jsx(V,{pageTitle:"HAPI Data Explorer",description:"Browse and explore datasets from HAPI (Heliophysics Application Programmer's Interface) servers",sx:{marginBottom:1,padding:2}}),e.jsx(h,{children:e.jsxs(C,{direction:"row",children:[e.jsxs(R,{elevation:0,sx:{flex:1,minHeight:"600px",minWidth:0},children:[e.jsx(re,{searchTerm:s,setSearchTerm:n,selectedServer:t,onServerChange:d}),e.jsx(X,{serverUrl:t.url,searchTerm:s,setPreviewItem:i})]}),r&&e.jsx(h,{sx:{minWidth:"400px"},children:e.jsx(ne,{previewItem:r,serverUrl:t.url,onClose:c})})]})})]})};export{Se as component};
