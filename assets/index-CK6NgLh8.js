import{d as v,j as e,B as h,F as N,p as q,q as F,t as L,v as z,G as W,H as V,J as _,S as y,T as j,D as B,o as H,R as G,P as $,L as R}from"./index-DcnBUCvk.js";import{P as O}from"./PageHeader-cYZfK1sc.js";import{S as K}from"./SciDataGrid-BhgJSMXn.js";import{u as k}from"./useQuery-DeZWyBTX.js";import{S as U,I as J,a as Q}from"./DataGrid-DkKFv-cA.js";import{A as b,C as Z}from"./Close-B2iEjmAL.js";import{M as X}from"./MenuItem-xipn-sdZ.js";import{P as Y}from"./react-plotly-CzDeOvhX.js";import"./Grid-JGnD0hLY.js";import"./FilterField-CTo0T6y9.js";import"./DatePicker-DuhgoyjL.js";import"./DateCalendar-DrwYsUjv.js";import"./colorManipulator-DwTTea71.js";import"./useGridRootProps-DifZIRrY.js";import"./Divider-D2-uqzfF.js";import"./dividerClasses-B1_t37qH.js";const ee=async(t,n)=>{try{const s=await fetch(`${t}/info?id=${encodeURIComponent(n)}`);if(!s.ok)return console.warn(`Failed to fetch info for dataset ${n}: ${s.statusText}`),{};const r=await s.json();return r.status.code!==1200?(console.warn(`HAPI error for dataset ${n}: ${r.status.message}`),{}):{startDate:r.startDate,stopDate:r.stopDate,description:r.description}}catch(s){return console.warn(`Error fetching info for dataset ${n}:`,s),{}}},te=t=>k({queryKey:["hapi-catalog",t],queryFn:async()=>{const n=await fetch(`${t}/catalog`);if(!n.ok)throw new Error(`Failed to fetch HAPI catalog: ${n.statusText}`);const s=await n.json();if(s.status.code!==1200)throw new Error(`HAPI error: ${s.status.message}`);const i=(s.catalog||[]).map(async l=>{const p=await ee(t,l.id);return{...l,...p}});return await Promise.all(i)},staleTime:5*60*1e3}),ae=({serverUrl:t,searchTerm:n,setPreviewItem:s})=>{const[r,i]=v.useState(0),[a,l]=v.useState(25),{isPending:p,isFetching:d,isError:D,data:m,error:x}=te(t),f=v.useMemo(()=>{if(!m)return[];if(!n)return m;const o=n.toLowerCase();return m.filter(c=>{var g,u;return c.id.toLowerCase().includes(o)||((g=c.title)==null?void 0:g.toLowerCase().includes(o))||((u=c.description)==null?void 0:u.toLowerCase().includes(o))})},[m,n]),w=o=>{s(o.row)},S=o=>{if(!o.startDate||!t)return"";const c=new Date(o.startDate),g=o.stopDate?new Date(o.stopDate):new Date,u=new Date(c);u.setDate(u.getDate()+14);const E=u<g?u:g,T=c.toISOString(),M=E.toISOString();return`${t}/data?id=${encodeURIComponent(o.id)}&time.min=${T}&time.max=${M}`},P=o=>{const c=o.pageSize!==a?0:o.page;i(c),l(o.pageSize)};if(p){const c=new Array(a).fill(null).map((g,u)=>u);return e.jsx(h,{sx:{padding:2},children:c.map(g=>e.jsx(U,{height:50},g))})}return D?e.jsx(b,{severity:"error",children:x.message}):e.jsxs(e.Fragment,{children:[d&&e.jsx(N,{variant:"indeterminate"}),e.jsx(K,{rows:f,pagination:!0,paginationMode:"client",onPaginationModelChange:P,getRowId:o=>o.id,columns:[{field:"id",headerName:"Dataset ID",width:250,flex:1},{field:"title",headerName:"Title",width:300,flex:2},{field:"startDate",headerName:"Start Date",width:180},{field:"stopDate",headerName:"Stop Date",width:180},{field:"requestUrl",headerName:"Request URL",width:400,flex:2,valueGetter:(o,c)=>S(c),renderCell:o=>e.jsx(h,{component:"a",href:o.value,target:"_blank",rel:"noopener noreferrer",sx:{color:"primary.main",textDecoration:"none",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block","&:hover":{textDecoration:"underline"}},children:o.value})},{field:"description",headerName:"Description",width:400,flex:2}],disableColumnSelector:!0,autoHeight:!0,initialState:{pagination:{paginationModel:{page:r,pageSize:a}}},onRowClick:w})]})};var C={},A;function re(){if(A)return C;A=1;var t=q();Object.defineProperty(C,"__esModule",{value:!0}),C.default=void 0;var n=t(F()),s=L();return C.default=(0,n.default)((0,s.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),C}var ne=re();const se=z(ne),I=[{id:"cdaweb",name:"CDAWeb",url:"https://cdaweb.gsfc.nasa.gov/hapi"},{id:"intermagnet",name:"INTERMAGNET",url:"https://imag-data.bgs.ac.uk/GIN_V1/hapi"},{id:"lasp",name:"LASP",url:"https://lasp.colorado.edu/lisird/hapi"},{id:"knmi",name:"KNMI",url:"https://hapi.spaceweather.knmi.nl/hapi"},{id:"helioviewer",name:"Helioviewer",url:"https://api.helioviewer.org/hapi/Helioviewer/hapi"}],oe=({selectedServer:t,onServerChange:n})=>{const s=r=>{const i=I.find(a=>a.id===r.target.value);i&&n(i)};return e.jsxs(W,{sx:{minWidth:200},size:"small",children:[e.jsx(V,{id:"hapi-server-select-label",children:"HAPI Server"}),e.jsx(_,{labelId:"hapi-server-select-label",id:"hapi-server-select",value:t.id,label:"HAPI Server",onChange:s,children:I.map(r=>e.jsx(X,{value:r.id,children:r.name},r.id))})]})},ie=({searchTerm:t,setSearchTerm:n,selectedServer:s,onServerChange:r})=>{const i=l=>{n(l.target.value)},a=()=>{n("")};return e.jsxs(y,{direction:"row",spacing:2,alignItems:"center",sx:{overflow:"hidden",padding:2},children:[e.jsxs(j,{variant:"h6",component:"h2",flex:1,children:[s.name," Datasets"]}),e.jsx(oe,{selectedServer:s,onServerChange:r}),e.jsx(B,{variant:"outlined",label:"Search",size:"small",value:t,onChange:i,InputProps:{endAdornment:t&&e.jsx(J,{position:"end",children:e.jsx(H,{"aria-label":"clear search",onClick:a,edge:"end",size:"small",children:e.jsx(se,{})})})}})]})},le=(t,n)=>k({queryKey:["hapi-data-preview",t,n],queryFn:async()=>{try{const s=await fetch(`${t}/info?id=${encodeURIComponent(n)}`);if(!s.ok)throw new Error(`Failed to fetch dataset info: ${s.statusText}`);const r=await s.json();if(r.status.code!==1200)throw new Error(`HAPI error: ${r.status.message}`);const i=r.startDate;if(!i)throw new Error("Dataset does not have a start date");const a=new Date(i),l=new Date(a);l.setDate(l.getDate()+14);const p=l.toISOString().split(".")[0]+"Z",d=await fetch(`${t}/data?id=${encodeURIComponent(n)}&time.min=${i}&time.max=${p}`);if(!d.ok)throw new Error(`Failed to fetch data: ${d.statusText}`);const m=(await d.text()).trim().split(`
`),x=[];for(let f=0;f<m.length;f++){const w=m[f].trim();if(w&&!w.startsWith("#")){const S=w.split(",");x.push(S)}}return{HAPI:r.HAPI,status:r.status,startDate:r.startDate,stopDate:r.stopDate,parameters:r.parameters||[],data:x}}catch(s){throw console.error("Error fetching HAPI data preview:",s),s}},enabled:!!t&&!!n,staleTime:10*60*1e3}),ce=({previewItem:t,serverUrl:n,onClose:s})=>{var d;const{isPending:r,isError:i,data:a,error:l}=le(n,t.id),p=G.useMemo(()=>{if(!a||!a.parameters||!a.data||a.data.length===0)return[];const D=a.data.map(x=>x[0]);return a.parameters.slice(1).map((x,f)=>{const w=f+1,S=a.data.map(P=>P[w]);return{x:D,y:S,type:"scatter",mode:"lines+markers",name:x.name,marker:{size:4},line:{width:2}}})},[a]);return e.jsx($,{elevation:0,sx:{height:"100%",padding:2},children:e.jsxs(y,{spacing:3,children:[e.jsxs(y,{spacing:1,children:[e.jsxs(y,{direction:"row",children:[e.jsx(j,{variant:"h6",component:"h3",flex:1,children:t.title||t.id}),e.jsx(H,{size:"small",onClick:s,children:e.jsx(Z,{})})]}),t.description&&e.jsx(j,{variant:"body2",children:t.description})]}),e.jsxs(h,{children:[e.jsx(j,{fontWeight:"medium",mb:1,children:"Data Preview (2 weeks)"}),r&&e.jsx(h,{sx:{display:"flex",justifyContent:"center",padding:3},children:e.jsx(Q,{})}),i&&e.jsxs(b,{severity:"error",children:["Error loading data: ",(l==null?void 0:l.message)||"Unknown error"]}),a&&a.data&&a.data.length>0&&e.jsxs(h,{children:[e.jsxs(j,{variant:"body2",color:"text.secondary",mb:1,children:["Showing ",a.data.length," records from ",a.startDate]}),e.jsx(Y,{data:p,layout:{autosize:!0,margin:{l:50,r:20,t:20,b:50},xaxis:{title:((d=a.parameters[0])==null?void 0:d.name)||"Time",type:"date"},yaxis:{title:"Value"},legend:{orientation:"h",yanchor:"bottom",y:1.02,xanchor:"right",x:1},hovermode:"closest"},config:{responsive:!0,displayModeBar:!0,displaylogo:!1},style:{width:"100%",height:"400px"}})]}),a&&a.data&&a.data.length===0&&e.jsx(b,{severity:"info",children:"No data available for this dataset."})]}),e.jsxs(h,{children:[e.jsx(j,{fontWeight:"medium",mb:1,children:"Dataset Information"}),e.jsx(R,{rows:[{label:"Dataset ID",value:t.id},{label:"Title",value:t.title||"N/A"},{label:"Contact",value:t.contact||"N/A"}]})]}),e.jsxs(h,{children:[e.jsx(j,{fontWeight:"medium",mb:1,children:"Time Range"}),e.jsx(R,{rows:[{label:"Start Date",value:t.startDate||"N/A"},{label:"Stop Date",value:t.stopDate||"N/A"}]})]})]})})},be=function(){const[n,s]=v.useState(""),[r,i]=v.useState(),[a,l]=v.useState(I[0]),p=D=>{l(D),i(null)},d=()=>{i(null)};return e.jsxs(h,{children:[e.jsx(O,{pageTitle:"HAPI Data Explorer",description:"Browse and explore datasets from HAPI (Heliophysics Application Programmer's Interface) servers",sx:{marginBottom:1,padding:2}}),e.jsx(h,{children:e.jsxs(y,{direction:"row",children:[e.jsxs($,{elevation:0,sx:{flex:1,minHeight:"600px",minWidth:0},children:[e.jsx(ie,{searchTerm:n,setSearchTerm:s,selectedServer:a,onServerChange:p}),e.jsx(ae,{serverUrl:a.url,searchTerm:n,setPreviewItem:i})]}),r&&e.jsx(h,{sx:{minWidth:"400px"},children:e.jsx(ce,{previewItem:r,serverUrl:a.url,onClose:d})})]})})]})};export{be as component};
